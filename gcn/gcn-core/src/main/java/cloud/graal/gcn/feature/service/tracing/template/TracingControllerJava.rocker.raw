@import io.micronaut.starter.application.Project

@args (Project project)

@if (project.getPackageName() != null) {
package @(project.getPackageName()).controller;

import @(project.getPackageName()).client.TracingClient;
}
import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Header;
import io.micronaut.tracing.annotation.ContinueSpan;
import io.micronaut.tracing.annotation.SpanTag;
import io.opentelemetry.extension.annotations.WithSpan;

@@Controller("/trace")
class TracingController {

    private final TracingClient tracingClient;

    TracingController(TracingClient tracingClient) {
        this.tracingClient = tracingClient;
    }

    @@Get("/test")
    @@ContinueSpan
    String test(@@SpanTag("test_trace_id") @@Header("X-TrackingId") String tracingId) {
        return tracingClient.test2(tracingId);
    }

    @@Get("/test2")
    @@WithSpan
    String test2(@@SpanTag("test_trace_id2") @@Header("X-TrackingId") String tracingId) {
        return tracingId;
    }
}
